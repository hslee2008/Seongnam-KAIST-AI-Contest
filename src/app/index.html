<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>SEAIF – Chat Only</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{
      --primary:#4A69E2;
      --background:#F7F8FC;
      --border-color:#EEEEEE;
      --text-placeholder:#9E9E9E;
    }
    @supports(padding:max(0px)){
      .pt-safe{padding-top:env(safe-area-inset-top)}
      .pb-safe{padding-bottom:env(safe-area-inset-bottom)}
    }
    body{
      font-family:'Pretendard',-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans","Apple SD Gothic Neo","Malgun Gothic",sans-serif;
      background:var(--background);
    }
    .shadow-strong{ box-shadow:0 8px 24px rgba(74,105,226,.2); }

    /* 채팅 말풍선 */
    .bubble-enter{
      transform:translateY(8px) scale(.98);
      opacity:.0;
    }
    .bubble-enter-active{
      transform:translateY(0) scale(1);
      opacity:1;
      transition:transform .22s cubic-bezier(.2,.7,.2,1), opacity .22s ease;
    }
  </style>
</head>
<body>
  <div class="w-full min-h-screen flex items-start justify-center bg-gray-200">
    <div id="screen" class="relative mx-auto w-[min(430px,100vw)] min-h-[100dvh] bg-[color:var(--background)]">

      <!-- 채팅 페이지 (단일 화면) -->
      <main id="page-chat" class="page active">
        <header class="pt-safe sticky top-0 z-10 px-4 py-2 bg-white/80 backdrop-blur-lg border-b border-[color:var(--border-color)]">
          <div class="flex items-center h-[56px]">
            <div class="text-lg font-bold text-center flex-1">AI 어시스턴트</div>
          </div>
        </header>

        <!-- 대화 영역 -->
        <div id="chat-list" class="px-4 pt-3 pb-28 min-h-[calc(100dvh-150px)]"></div>

        <!-- 입력창 -->
        <div class="pb-safe fixed bottom-0 left-1/2 -translate-x-1/2 w-[min(430px,100vw)] bg-white/80 backdrop-blur-lg border-t border-[color:var(--border-color)]">
          <div class="p-3 flex items-center gap-2">
            <button aria-label="추가 옵션" class="w-10 h-10 rounded-full flex items-center justify-center text-gray-500 hover:bg-gray-100">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12h14" /></svg>
            </button>
            <div class="flex-1 h-[48px] rounded-full bg-gray-100 flex items-center px-4">
              <input id="chat-input" class="flex-1 bg-transparent outline-none text-[15px] placeholder-[color:var(--text-placeholder)]" placeholder="무엇이든 물어보세요" />
            </div>
            <button id="chat-send" aria-label="전송" class="w-12 h-12 bg-[color:var(--primary)] rounded-full flex items-center justify-center shadow-strong active:scale-95 transition-transform">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="white"><path d="M3.4 20.4l17.4-8.4c.5-.2.5-.9 0-1.2L3.4 2.4c-.5-.2-1 .2-1 .7v5.5c0 .3.2.6.5.6l8.6.9c.2 0 .2.2 0 .3l-8.6.9c-.3 0-.5.3-.5.6V19.7c0 .5.4 1 1 .7z"/></svg>
            </button>
          </div>
        </div>
      </main>
    </div>
  </div>

  <script>
    // 단일 상태: 채팅 전용
    let chat = [
      { role: "assistant", content: "안녕하세요! 성남의 다양한 행사, 뭐든 물어보세요 :)" }
    ];
    let loading = false;

    const $ = (sel, root=document)=>root.querySelector(sel);

    function appendBubble(role, content){
      const list = $("#chat-list");
      const wrap = document.createElement("div");
      const isUser = role === "user";
      wrap.className = `flex my-2 ${isUser ? "justify-end" : "justify-start"} bubble-enter`;
      wrap.innerHTML = `
        <div class="max-w-[75%] px-4 py-3 text-white rounded-2xl ${isUser ? 'bg-[color:var(--primary)] rounded-br-none' : 'bg-gray-400 rounded-bl-none'}">
          ${content}
        </div>
      `;
      list.appendChild(wrap);
      // 작은 등장 애니메이션
      requestAnimationFrame(()=>{
        wrap.classList.add("bubble-enter-active");
        wrap.classList.remove("bubble-enter");
      });
      list.scrollTo({ top:list.scrollHeight, behavior:"smooth" });
    }

    function renderChat(){
      const list = $("#chat-list");
      list.innerHTML = "";
      chat.forEach(m => appendBubble(m.role, m.content));
    }

    // 모의 응답 (API 대체)
    function enqueueMockResponse(userMsg){
      loading = true;
      setTimeout(()=>{
        try{
          const responseText = `네, '${userMsg}'와 관련된 정보를 정리해 드릴게요. 더 구체적으로 원하시면 말씀해 주세요!`;
          chat.push({ role:"assistant", content: responseText });
          appendBubble("assistant", responseText);
        } catch(e){
          chat.push({ role:"assistant", content:"죄송합니다, 오류가 발생했어요." });
          appendBubble("assistant", "죄송합니다, 오류가 발생했어요.");
        } finally{
          loading = false;
        }
      }, 600);
    }

    // 전송 로직 (채팅 전용)
    const chatInput = $("#chat-input");
    const chatSend  = $("#chat-send");

    function sendChat(){
      const msg = chatInput.value.trim();
      if(!msg || loading) return;

      // iMessage 느낌: 입력창에서 말풍선으로 "자연스럽게 이동"하는 연출
      // 1) 입력값 확보 후 입력창 초기화
      chatInput.value = "";

      // 2) 실제 말풍선 추가
      chat.push({ role:"user", content: msg });
      appendBubble("user", msg);

      // 3) 모의 응답
      enqueueMockResponse(msg);
    }

    chatSend.addEventListener("click", sendChat);
    chatInput.addEventListener("keydown", (e)=>{
      if(e.key === "Enter" && !e.isComposing){
        e.preventDefault();
        sendChat();
      }
    });

    // 초기 렌더
    renderChat();
  </script>
</body>
</html>
